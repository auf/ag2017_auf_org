<form method="post">
  {% csrf_token %}
  {% if message_echec %}
    <ul class="errorlist">
      <li>{{ message_echec }}</li>
    </ul>
  {% endif %}

  {{ formset.management_form }}
  {% regroup lignes by candidat.region as lignes_by_region %}
  {% for region_lignes in lignes_by_region %}
    {% if not critere.une_seule_region %}
      <h2>{{ region_lignes.grouper.nom }}</h2>
    {% endif %}
    <table>
      <tr>
        <th>Nom</th>
        <th>Prénom</th>
        <th>Poste</th>
        <th>Établissement</th>
        <th>Suppléant</th>
        <th>Aucune</th>
        {% for election in elections %}
          <th>{{ election.code }}</th>
        {% endfor %}
        <th>Suppléant de</th>
        <th>Statut</th>
        <th></th>
      </tr>

      {% for ligne in region_lignes.list %}
        <tr>
        {% if ligne.form %}
          {% with ligne.form as form %}
          {{ form.participant_id }}
          {{ form.last_modified }}
          <td width="9%">{{ form.candidat.nom }}</td>
          <td width="9%">{{ form.candidat.prenom }}</td>
          <td width="7%">{{ form.candidat.poste }}</td>
          <td width="10%">{{ form.candidat.etablissement_nom }}</td>
          <td width="10%">
            {% if form.suppleant %}
            {{ form.suppleant.nom_complet }}
            {% else %}
              -
            {% endif %}
          </td>
          {% for radio in form.election %}
            <td width="3%">
              <input type="radio" id="{{ radio.attrs.id }}"
                     {% if radio.choice_value and not radio.choice_value in form.candidatures_possibles %}
                     disabled="disabled"
                     {% endif %}
                     name="{{ radio.name }}"
                     value="{{ radio.choice_value }}"
                     {% if radio.is_checked %}checked="checked"{% endif %}/>
            </td>
          {% endfor %}
          <td width="10%">
              <span class="js-select-suppleant" {% if form.election.value != "S" %} style="display: none;"{% endif %}>
              {{ form.suppleant_de_id }}
              </span>
          </td>
          <td width="10%">
            {% if form.candidat.code_election %}
            {{ form.statut }}
            {% endif %}
          </td>
          <td width="5%">Libre ? {{ form.libre }}</td>
          {% endwith %}
        {% else %}
          <td width="9%">{{ ligne.candidat.nom }}</td>
          <td width="9%">{{ ligne.candidat.prenom }}</td>
          <td width="7%">{{ ligne.candidat.poste }}</td>
          <td width="10%">{{ ligne.candidat.etablissement_nom }}</td>
          <td></td>
          <td colspan="7"><span class="candidat-elu">
            Élu {{ ligne.candidat.code_election }}</span></td>
        {% endif %}
        </tr>
      {% endfor %}
    </table>
  {% endfor %}
  </form>